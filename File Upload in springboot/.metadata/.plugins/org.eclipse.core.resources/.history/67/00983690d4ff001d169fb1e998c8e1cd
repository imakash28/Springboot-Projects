package com.example.demo.helper;

import java.io.InputStream;
import java.util.ArrayList;
import java.util.Iterator;
import java.util.List;

import org.apache.poi.hssf.usermodel.HSSFSheet;
import org.apache.poi.hssf.usermodel.HSSFWorkbook;
import org.apache.poi.ss.usermodel.Cell;
import org.apache.poi.ss.usermodel.CellType;
import org.apache.poi.ss.usermodel.Row;
import org.apache.poi.ss.usermodel.Workbook;
import org.apache.poi.xssf.usermodel.XSSFSheet;
import org.apache.poi.xssf.usermodel.XSSFWorkbook;
import org.springframework.web.multipart.MultipartFile;

import com.example.demo.model.Student;

public class ExcelHelper {

	/**
	 * In this class we are writing 2 methods
	 * 1. To check the multipart file we are giving is excel file or not?
	 * 2.
	 * */
	
//Check that file is excel type or not
	public static boolean checkExcelFormat(MultipartFile file)
	{
		String contentType=file.getContentType();
		if(contentType.equals("application/vnd.ms-excel")) {
			return true;
		}
		else {
			return false;
		}
	}

	public static List<Student> convertExcelTOListOfStudent(InputStream is) {
	    List<Student> list = new ArrayList<>();
	    try {
	        HSSFWorkbook workbook = new HSSFWorkbook(is);
	        HSSFSheet sheet = workbook.getSheet("Student");

	        int rowIndex = 0;
		    for (Row row : sheet) {
		        if (rowIndex == 0) {
		            rowIndex++;
		            continue; // Skip the first row
		        }

		        Student data = new Student();

		        Cell cell1 = row.getCell(1);
		        if (cell1 != null) {
		            if (cell1.getCellType() == CellType.STRING) {
		                data.setName(cell1.getStringCellValue());
		            } else if (cell1.getCellType() == CellType.NUMERIC) {
		                data.setName(String.valueOf((int) cell1.getNumericCellValue()));
		            }
		        }

		        Cell cell0 = row.getCell(0);
		        if (cell0 != null) {
		            if (cell0.getCellType() == CellType.STRING) {
		                data.setId(cell0.getStringCellValue());
		            } else if (cell0.getCellType() == CellType.NUMERIC) {
		                data.setId(String.valueOf((int) cell0.getNumericCellValue()));
		            }
		        }

		        Cell cell3 = row.getCell(3);
		        if (cell3 != null) {
		            if (cell3.getCellType() == CellType.STRING) {
		                data.setBranch(cell3.getStringCellValue());
		            }
		        }

		        Cell cell2 = row.getCell(2);
		        if (cell2 != null) {
		            if (cell2.getCellType() == CellType.STRING) {
		                data.setRoll_No(cell2.getStringCellValue());
		            }
		        }

		        list.add(data);
		    }

		    workbook.close();
		    return list;
	    }
	